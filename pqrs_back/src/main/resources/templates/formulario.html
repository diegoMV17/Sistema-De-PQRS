<!--formulario.html-->
<!DOCTYPE html>
<html lang="es" class="scroll-smooth">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Sistema PQRS - Formulario</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        darkMode: "class",
        theme: {
          extend: {
            fontFamily: {
              sans: ["Inter", "system-ui", "sans-serif"],
              serif: ["Playfair Display", "serif"],
            },
          },
        },
      };
    </script>
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Playfair+Display:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
  </head>

  <body
    class="font-sans antialiased bg-gray-50 dark:bg-gray-900 transition-colors duration-300"
  >
    <!-- Navbar Container -->
    <div th:replace="~{fragments/navbar :: navbar}"></div>

    <!-- Main Content -->
    <main class="min-h-screen py-12">
      <!-- Formulario PQRS -->
      <section>
        <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
          <div class="text-center mb-12">
            <h1
              class="text-4xl md:text-5xl font-serif font-bold text-gray-900 dark:text-white mb-4"
            >
              Enviar PQRS
            </h1>
            <p
              class="text-lg text-gray-600 dark:text-gray-300 max-w-2xl mx-auto"
            >
              Completa el siguiente formulario para enviar tu petición, queja,
              reclamo o sugerencia
            </p>
          </div>

          <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-8">
            <form id="pqrs-form" class="space-y-6">
              <!-- Tipo de Solicitud -->
              <div>
                <label
                  for="tipo-solicitud"
                  class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"
                >
                  Tipo de Solicitud *
                </label>
                <select
                  id="tipo-solicitud"
                  name="tipoSolicitud"
                  required
                  class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100"
                >
                  <option value="">Selecciona una opción</option>
                  <option value="PETICION">Petición</option>
                  <option value="QUEJA">Queja</option>
                  <option value="RECLAMO">Reclamo</option>
                  <option value="SUGERENCIA">Sugerencia</option>
                </select>
              </div>

              <!-- Datos Personales -->
              <div class="grid md:grid-cols-2 gap-6">
                <div>
                  <label
                    for="tipo-documento"
                    class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"
                  >
                    Tipo de Documento *
                  </label>
                  <select
                    id="tipo-documento"
                    name="tipoDocumento"
                    required
                    class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100"
                  >
                    <option value="">Selecciona una opción</option>
                    <option value="CC">Cédula de Ciudadanía</option>
                    <option value="TI">Tarjeta de Identidad</option>
                    <option value="CE">Cédula de Extranjería</option>
                    <option value="PASAPORTE">Pasaporte</option>
                  </select>
                </div>
                <div>
                  <label
                    for="numero-documento"
                    class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"
                  >
                    Número de Documento *
                  </label>
                  <input
                    type="text"
                    id="numero-documento"
                    name="numeroDocumento"
                    required
                    class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100"
                    placeholder="Ingresa tu número de documento"
                  />
                </div>
              </div>

              <div class="grid md:grid-cols-2 gap-6">
                <div>
                  <label
                    for="nombres"
                    class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"
                  >
                    Nombres *
                  </label>
                  <input
                    type="text"
                    id="nombres"
                    name="nombres"
                    required
                    class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100"
                    placeholder="Tus nombres"
                  />
                </div>
                <div>
                  <label
                    for="apellidos"
                    class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"
                  >
                    Apellidos *
                  </label>
                  <input
                    type="text"
                    id="apellidos"
                    name="apellidos"
                    required
                    class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100"
                    placeholder="Tus apellidos"
                  />
                </div>
              </div>

              <div class="grid md:grid-cols-2 gap-6">
                <div>
                  <label
                    for="email"
                    class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"
                  >
                    Correo Electrónico *
                  </label>
                  <input
                    type="email"
                    id="email"
                    name="email"
                    required
                    class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100"
                    placeholder="tu@email.com"
                  />
                </div>
                <div>
                  <label
                    for="telefono"
                    class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"
                  >
                    Teléfono
                  </label>
                  <input
                    type="tel"
                    id="telefono"
                    name="telefono"
                    class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100"
                    placeholder="Número de teléfono"
                  />
                </div>
              </div>

              <!-- Descripción -->
              <div>
                <label
                  for="descripcion"
                  class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"
                >
                  Descripción de la Solicitud *
                </label>
                <textarea
                  id="descripcion"
                  name="descripcion"
                  rows="6"
                  required
                  class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 resize-none"
                  placeholder="Describe detalladamente tu petición, queja, reclamo o sugerencia..."
                ></textarea>
                <p class="text-sm text-gray-500 dark:text-gray-400 mt-2">
                  Mínimo 50 caracteres
                </p>
              </div>

              <!-- Términos y Condiciones -->
              <div class="flex items-start">
                <input
                  type="checkbox"
                  id="terminos"
                  name="terminos"
                  required
                  class="mt-1 h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"
                />
                <label
                  for="terminos"
                  class="ml-2 text-sm text-gray-700 dark:text-gray-300"
                >
                  Acepto los
                  <a
                    href="#"
                    class="text-blue-600 dark:text-blue-400 hover:underline"
                    >términos y condiciones</a
                  >
                  y autorizo el tratamiento de mis datos personales *
                </label>
              </div>

              <!-- Botones -->
              <div class="flex flex-col sm:flex-row gap-4 pt-6">
                <button
                  type="submit"
                  class="flex-1 bg-blue-600 hover:bg-blue-700 text-white px-8 py-4 rounded-lg font-semibold text-lg transition-colors duration-200 shadow-lg hover:shadow-xl"
                >
                  Enviar PQRS
                </button>
                <button
                  type="reset"
                  class="flex-1 bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-300 dark:hover:bg-gray-600 px-8 py-4 rounded-lg font-semibold text-lg transition-colors duration-200"
                >
                  Limpiar Formulario
                </button>
              </div>
            </form>
          </div>

          <!-- Información Adicional -->
          <div class="mt-12 bg-blue-50 dark:bg-blue-900/20 rounded-xl p-6">
            <h3
              class="text-lg font-semibold text-gray-900 dark:text-white mb-4"
            >
              Información Importante
            </h3>
            <ul class="space-y-2 text-gray-600 dark:text-gray-300">
              <li>
                • Recibirás un número de radicado para hacer seguimiento a tu
                solicitud
              </li>
              <li>• El tiempo de respuesta es de 5 días hábiles</li>
              <li>• Todos los campos marcados con * son obligatorios</li>
            </ul>
          </div>
        </div>
      </section>
    </main>

    <!-- Modal de Confirmación -->
    <div
      id="modal-confirmacion"
      class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50"
    >
      <div
        class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-8 max-w-md w-full text-center"
      >
        <h2
          id="modal-titulo"
          class="text-2xl font-semibold mb-4 text-gray-900 dark:text-white"
        ></h2>
        <p id="modal-mensaje" class="text-gray-700 dark:text-gray-300 mb-6"></p>
        <button
          id="modal-cerrar"
          class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-lg font-semibold transition-colors"
        >
          Cerrar
        </button>
      </div>
    </div>

    <script>
      const modal = document.getElementById("modal-confirmacion");
      const modalTitulo = document.getElementById("modal-titulo");
      const modalMensaje = document.getElementById("modal-mensaje");
      const modalCerrar = document.getElementById("modal-cerrar");

      function mostrarModal(titulo, mensaje) {
        modalTitulo.textContent = titulo;
        modalMensaje.textContent = mensaje;
        modal.classList.remove("hidden");
      }

      modalCerrar.addEventListener("click", () => {
        modal.classList.add("hidden");
      });

      document
        .getElementById("pqrs-form")
        .addEventListener("submit", async function (e) {
          e.preventDefault();

          const descripcion = document.getElementById("descripcion").value;
          const numeroDocumento =
            document.getElementById("numero-documento").value;
          const correo = document.getElementById("email").value;
          const numeroTelefono = document.getElementById("telefono").value;

          // Validar longitud mínima de la descripción
          if (descripcion.length < 50) {
            mostrarModal(
              "❌ Error",
              "La descripción debe tener al menos 50 caracteres"
            );
            return;
          }

          // Validar que el numero de documento solo contenga numeros
          if (!/^\d+$/.test(numeroDocumento)) {
            mostrarModal(
              "❌ Error",
              "El número de documento debe contener solo números."
            );
            return;
          }

          // Validar que el numero de documento tenga maximo 10 digitos
          if (numeroDocumento.length > 10) {
            mostrarModal(
              "❌ Error",
              "El número de documento no puede tener más de 10 dígitos."
            );
            return;
          }

          // Validar que sea un correo electronico valido
          if (
            !/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/i.test(correo)
          ) {
            mostrarModal(
              "❌ Error",
              "Por favor ingresa un correo electrónico válido."
            );
            return;
          }

          // Validar que solo tenga números
          if (!/^\d+$/.test(numeroTelefono)) {
            mostrarModal(
              "❌ Error",
              "El número de teléfono debe contener solo números."
            );
            return;
          }

          // Validar que tenga exactamente 10 dígitos
          if (numeroTelefono.length !== 10) {
            mostrarModal(
              "❌ Error",
              "El número de teléfono debe tener 10 dígitos."
            );
            return;
          }

          const pqrsData = {
            tipo: document.getElementById("tipo-solicitud").value,
            descripcion: descripcion,
            peticionario: {
              tipoDocumento: document.getElementById("tipo-documento").value,
              numeroDocumento: numeroDocumento,
              nombres: document.getElementById("nombres").value,
              apellidos: document.getElementById("apellidos").value,
              email: document.getElementById("email").value,
              telefono: document.getElementById("telefono").value,
            },
          };

          try {
            const response = await fetch("http://localhost:8080/api/pqrs", {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
              },
              body: JSON.stringify(pqrsData),
            });

            if (!response.ok) {
              throw new Error("Error en la solicitud");
            }

            const result = await response.json();

            mostrarModal(
              "✅ PQRS enviada",
              "Número de radicado: " + result.numeroRadicado
            );
            this.reset();
          } catch (error) {
            console.error(error);
            mostrarModal(
              "❌ Error",
              "Error al enviar la PQRS. Intenta nuevamente."
            );
          }
        });
    </script>
  </body>
</html>
